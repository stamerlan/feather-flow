%% set year = calendar.year(2026)
%% set month_backgrounds = (
  "assets/month-jan.png", "assets/month-feb.png", "assets/month-mar.png",
  "assets/month-apr.png", "assets/month-may.png", "assets/month-jun.png",
  "assets/month-jul.png", "assets/month-aug.png", "assets/month-sep.png",
  "assets/month-oct.png", "assets/month-nov.png", "assets/month-dec.png",
)

%% macro day_style(day)
  {% if day.is_off_day %} style="color: #C00000"{% endif %}
%% endmacro

%% macro month_table(month)
  %% for week in month.table
    <tr>
      %% for day in week
        %% if day is not none
          <td {{- day_style(day) }}><a href="#{{ day.id }}">{{ day }}</a></td>
        %% else
          <td></td>
        %% endif
      %% endfor
    </tr>
  %% endfor
%% endmacro

<!doctype html>
<html>
<head>
  ## Planner head is used to inject additional elements into the HTML during
  ## document generation. For example, to set the base URL into the HTML.
  {{ planner_head }}
  <meta charset="utf-8">
  <link rel="stylesheet" href="assets/ff-2026.css">
  <link rel="stylesheet" href="assets/cormorant-garamond.css">
  %% if lang == "kr"
  <link rel="stylesheet" href="assets/noto-serif-kr.css">
  <style>
    .page {
      font-family: "Noto Serif KR", "Cormorant Garamond", Georgia, system-ui, serif;
    }
    .year-grid {
      font-family: "Noto Serif KR", "Cormorant Garamond", Georgia, system-ui, serif;
    }
    .month-name {
      letter-spacing: 3mm;
    }
    .year-grid-month-table td {
      font-size: 13pt;
    }
    .day-header-days-row {
      font-size: 12pt;
    }
  </style>
  %% endif
</head>
<body>
  ## Set opacity to enforce Chromium to rasterize page. Necessary for correct
  ## reflection effect in generated PDF.
  <div class="page" style="filter: opacity(100%);">
    <img class="background" src="assets/cover.png">
    <div class="cover-title">
      Feather Flow {{ year }}
      <div class="cover-title-reflection">Feather Flow {{ year }}</div>
    </div>
  </div>

  <div class="page" id="{{ year.id }}">
    <img class="background" src="assets/year.png">
    <div class="year-title">{{ year }}</div>
    <div class="year-grid">
      %% for month in year.months
      <section style="width: 100%;">
        <div class="year-grid-month-name"><a href="#{{ month.id }}">{{ month }}</a></div>
        <table class="year-grid-month-table">
          <thead>
            <tr>
              %% for day in calendar.weekdays
              <th {{- day_style(day) }}>{{ day.letter }}</th>
              %% endfor
            </tr>
          </thead>
          <tbody>
            {{ month_table(month) }}
          </tbody>
        </table>
      </section>
      %% endfor
    </div>
  </div>

  %% for month in year.months
  <div class="page" id="{{ month.id }}">
    <img class="background" src="{{ month_backgrounds[loop.index0] }}">
    <div class="month-header">
      %% for m in year.months
      <a href="#{{ m.id }}">{{ m.short_name }}</a>
      %% endfor
    </div>
    <div class="month-name">{{ month }}</div>
    <div class="month-year"><a href="#{{ year.id }}">{{ year }}</a></div>
    <table class="month-table">
      <thead>
        <tr>
          %% for day in calendar.weekdays
          <th {{- day_style(day) }}>{{ day.short_name }}</th>
          %% endfor
        </tr>
      </thead>
      <tbody>
        {{ month_table(month) }}
      </tbody>
    </table>
  </div>

  %% for day in month.days
  <div class="page" id="{{ day.id }}">
    <img class="background" src="assets/day.png" style="z-index: -2;">

    <!-- Dotted lines to write on -->
    <div class="background" style="z-index: -1;">
      <svg xmlns="http://www.w3.org/2000/svg" width="210mm" height="297mm" viewBox="0 0 210 297">
        <defs>
          <!-- Dot spacing: 8px horizontal, 4px line height + 8mm between lines (8px ~ 2.117mm) -->
          <pattern id="d" width="2.116666" height="9.058333" patternUnits="userSpaceOnUse">
            <circle cx="0.5291665" cy="0.5291665" r="0.15875" fill="#404040"/>
          </pattern>
        </defs>
        <!-- A4 with padding: top 40mm, bottom 10mm, left/right 5mm. Dots only in content area. -->
        <rect x="5" y="40" width="200" height="247" fill="url(#d)"/>
      </svg>
    </div>

    <div class="day-header">
      <div class="day-header-date">
        <p class="day-header-day">{{ day }}</p>
        <p class="day-header-month">{{ month }}</p>
        <p class="day-header-weekday" {{- day_style(day) }}>{{ day.weekday }}</p>
      </div>

      <div class="day-header-tables">
        <div class="day-header-months-row">
          %% for m in year.months
          <a href="#{{ m.id }}">{{ m.short_name }}</a>
          %% endfor
        </div>
        <div class="day-header-days-row">
          %% for d in month.days
          <a href="#{{ d.id }}">{{ d }}</a>
          %% endfor
        </div>
      </div>
    </div>
  </div>
  %% endfor

  %% endfor
</body>
